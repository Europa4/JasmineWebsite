<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jasmine's Legacy of Dreams | Jasmine's Story</title>
    <!-- Favicon -->
    <link rel="icon" href="./Assets/Images/favicon.png" type="image/x-icon">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- CSS Styles -->
    <link rel="stylesheet" href="./Assets/css/main.css">
    <script src="./Assets/js/main.js"></script>
    <style>
        .tree ul {
            list-style-type: none;
        }
        .tree ul ul {
            margin-left: 20px;
        }
        .collapse a {
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="container d-flex justify-content-center">
        <div>
            <h1 class="text-center">Story Archive Tree</h1>
            <div id="tree" class="tree"></div>
        </div>
    </div>
    <br>
    <div id="footer-placeholder"></div>

    <script>
        // Fetch the data from the API
        fetch('/api/getDataForStoryArchiveTree')
            .then(response => response.json())
            .then(data => {
                const treeContainer = document.getElementById('tree');
                const treeHtml = buildTreeHTML(data);
                treeContainer.innerHTML = treeHtml;
            });

        // Helper function to create URLs based on id and title
        function createPageLink(id, title) {
            // Replace spaces with underscores in the title and construct the link
            const formattedTitle = title.replace(/\s+/g, '_');
            return `/stories/${id}_${formattedTitle}`;
        }

        // Recursive function to build the tree HTML with collapsible years and months
        function buildTreeHTML(data, parentKey = '') {
            let html = '<ul>';
            for (const key in data) {
                if (Array.isArray(data[key])) {
                    data[key].forEach(item => {
                        const url = createPageLink(item.id, item.title);
                        html += `<li><span>${key} - </span><a href="${url}">${item.title}</a></li>`;
                    });
                } else if (typeof data[key] === 'object') {
                    // Use both parent key (year) and current key (month) for unique collapse ID
                    const collapseId = `${parentKey}_${key.replace(/\s+/g, '_')}`; 
                    html += `
                        <li>
                            <strong>
                                <a data-bs-toggle="collapse" href="#${collapseId}" role="button" aria-expanded="false" aria-controls="${collapseId}">
                                    ${key}
                                </a>
                            </strong>
                            <div class="collapse" id="${collapseId}">
                                ${buildTreeHTML(data[key], collapseId)} <!-- Pass current collapseId as parentKey -->
                            </div>
                        </li>`;
                }
            }
            html += '</ul>';
            return html;
        }

    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
